# Compose Farm configuration
# Documentation: https://github.com/basnijholt/compose-farm
#
# This file configures compose-farm to manage Docker Compose stacks
# across multiple hosts via SSH.
#
# Place this file at:
#   - ./compose-farm.yaml (current directory)
#   - ~/.config/compose-farm/compose-farm.yaml
#   - Or specify with: cf --config /path/to/config.yaml
#   - Or set CF_CONFIG environment variable

# ------------------------------------------------------------------------------
# compose_dir: Directory containing stack subdirectories with compose files
# ------------------------------------------------------------------------------
# Each subdirectory should contain a compose.yaml (or docker-compose.yml).
# This path must be the same on all hosts (NFS mount recommended).
#
compose_dir: /opt/compose

# ------------------------------------------------------------------------------
# hosts: SSH connection details for each host
# ------------------------------------------------------------------------------
# Simple form:
#   hostname: ip-or-fqdn
#
# Full form:
#   hostname:
#     address: ip-or-fqdn
#     user: ssh-username      # default: current user
#     port: 22                # default: 22
#
# Note: "all" is a reserved keyword and cannot be used as a host name.
#
hosts:
  # Example: simple form (uses current user, port 22)
  server1: 192.168.1.10

  # Example: full form with explicit user
  server2:
    address: 192.168.1.20
    user: admin

  # Example: full form with custom port
  server3:
    address: 192.168.1.30
    user: root
    port: 2222

# ------------------------------------------------------------------------------
# stacks: Map stack names to their target host(s)
# ------------------------------------------------------------------------------
# Each stack name must match a subdirectory in compose_dir.
#
# Single host:
#   stack-name: hostname
#
# Multiple hosts (explicit list):
#   stack-name: [host1, host2]
#
# All hosts:
#   stack-name: all
#
stacks:
  # Example: stack runs on a single host
  nginx: server1
  postgres: server2

  # Example: stack runs on multiple specific hosts
  # prometheus: [server1, server2]

  # Example: stack runs on ALL hosts (e.g., monitoring agents)
  # node-exporter: all

# ------------------------------------------------------------------------------
# traefik_file: (optional) Auto-generate Traefik file-provider config
# ------------------------------------------------------------------------------
# When set, compose-farm automatically regenerates this file after
# up/down/update commands. Traefik watches this file for changes.
#
# traefik_file: /opt/compose/traefik/dynamic.d/compose-farm.yml

# ------------------------------------------------------------------------------
# traefik_stack: (optional) Stack name running Traefik
# ------------------------------------------------------------------------------
# When generating traefik_file, stacks on the same host as Traefik are
# skipped (they're handled by Traefik's Docker provider directly).
#
# traefik_stack: traefik

# ------------------------------------------------------------------------------
# glances_stack: (optional) Stack/container name for Glances
# ------------------------------------------------------------------------------
# When set, enables host resource monitoring in the web UI via the Glances API.
# This should be the container name that runs Glances on the same Docker network.
#
# glances_stack: glances

# ------------------------------------------------------------------------------
# local_host: (optional) Name of the local host for web UI
# ------------------------------------------------------------------------------
# When running the web UI in a Docker container, it may not be able to reach
# the local host's Glances API via its LAN IP due to network isolation.
# Set this to the name of the host where the web UI runs, and compose-farm
# will use the glances_stack container name instead of the IP address.
#
# local_host: server1

# ------------------------------------------------------------------------------
# web_stack: (optional) Name of the web UI stack
# ------------------------------------------------------------------------------
# When set, the web UI knows which stack it's running in. This enables:
# - Self-update detection: updates to the web stack run via SSH to survive
#   container restart
# - Exclusion from bulk operations: "Update All" skips the web stack to prevent
#   the UI from shutting down mid-operation
#
# web_stack: compose-farm
