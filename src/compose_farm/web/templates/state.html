{% extends "base.html" %}
{% block title %}State - Compose Farm{% endblock %}

{% block content %}
<article>
    <header>
        <hgroup>
            <h1>Deployment State</h1>
            <p>Services tracked in <code>compose-farm-state.yaml</code></p>
        </hgroup>
    </header>

    <!-- Actions -->
    <div role="group">
        <button hx-post="/api/refresh"
                hx-swap="none"
                class="secondary">
            Refresh from Reality
        </button>
    </div>

    <!-- Deployed Services -->
    <details open>
        <summary>Deployed Services ({{ state | length }})</summary>
        {% if state %}
        <table>
            <thead>
                <tr>
                    <th>Service</th>
                    <th>Running On</th>
                </tr>
            </thead>
            <tbody>
                {% for svc, host in state.items() | sort %}
                <tr>
                    <td><a href="/service/{{ svc }}">{{ svc }}</a></td>
                    <td><code>{% if host is iterable and host is not string %}{{ host | join(', ') }}{% else %}{{ host }}{% endif %}</code></td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        {% else %}
        <p><em>No services currently tracked in state file.</em></p>
        {% endif %}
    </details>

    <!-- Raw State YAML with syntax highlighting -->
    <details>
        <summary>Raw State (YAML)</summary>
        <div id="state-viewer" class="yaml-viewer" data-content="{{ state_content | e }}"></div>
    </details>

    <!-- Terminal -->
    <details open>
        <summary>Terminal Output</summary>
        <div id="terminal-container">
            <div id="terminal-output"></div>
        </div>
    </details>
</article>
{% endblock %}
