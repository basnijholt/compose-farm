{% extends "base.html" %}
{% block title %}Dashboard - Compose Farm{% endblock %}

{% block content %}
<article>
    <header>
        <hgroup>
            <h1>Dashboard</h1>
            <p>Compose Farm cluster overview</p>
        </hgroup>
    </header>

    <!-- Quick Stats -->
    <div class="grid">
        <article class="stat-card">
            <header>Hosts</header>
            <strong class="stat-value">{{ config.hosts | length }}</strong>
        </article>
        <article class="stat-card">
            <header>Services</header>
            <strong class="stat-value">{{ config.services | length }}</strong>
        </article>
        <article class="stat-card">
            <header>Deployed</header>
            <strong class="stat-value running">{{ state | length }}</strong>
        </article>
    </div>

    <details open>
        <summary>Hosts</summary>
        <table>
            <thead>
                <tr>
                    <th>Name</th>
                    <th>Address</th>
                    <th>Services</th>
                </tr>
            </thead>
            <tbody>
                {% for name, host in config.hosts.items() %}
                <tr>
                    <td><strong>{{ name }}</strong></td>
                    <td><code>{{ host.address }}</code></td>
                    <td>
                        {% set count = [] %}
                        {% for svc, svc_host in state.items() %}
                            {% if svc_host == name or (svc_host is iterable and svc_host is not string and name in svc_host) %}
                                {% if count.append(1) %}{% endif %}
                            {% endif %}
                        {% endfor %}
                        {{ count | length }}
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </details>
</article>
{% endblock %}
